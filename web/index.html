<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vshell web</title>
    <script src="./src/tailwind/tailwind.js"></script>
    <script src="./src/react/react.production.min.js"></script>
    <script src="./src/react/react-dom.production.min.js"></script>
    <script src="./src/react/babel.min.js"></script>
    <style>
        *::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="bg-slate-900 text-white">

    <script type="text/babel">

        const username = String(Math.random()).split('.')[1];
        const password = String(Math.random()).split('.')[1];

        

        const reg = new RegExp('```(.*?)```', 'gi');
        const formated = ''.replace(reg, '<code>$1</code>');
        console.log(formated);

        function UserInput(props) {
            function onKeyDown(ev){
                if (ev.key === 'Enter' && !ev.shiftKey) {
                    ev.preventDefault();
                    props.handleSend();
                }
            }
            return <div className='w-full h-16 mb-4 flex pt-4 justify-center'>
                <div className='w-full h-full bg-slate-800 rounded-full mr-4 ml-2 border-2 border-slate-700 flex items-center pl-4 pr-4 hover:border-indigo-500/50 focus-within:border-indigo-500 transition-all duration-200'>
                    <input
                        type="text"
                        className='w-full h-full bg-transparent outline-none text-white placeholder-slate-400'
                        onInput={props.handleInput}
                        onKeyDown={onKeyDown}
                        value={props.message}
                        placeholder='Escribe tu mensaje aquí y presiona Enter'
                    />
                </div>
                <div>
                    <button
                        className='w-12 h-12 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full mr-2 cursor-pointer active:scale-95 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-indigo-500/50 hover:scale-105'
                        role='button'
                        aria-label='Enviar'
                        onClick={props.handleSend}
                        title='Enviar'
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className='w-6 h-6'>
                            <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                        </svg>
                    </button>
                </div>
            </div>
        }

        function Message(props) {
            let style1, style2;
            if (props.rol == 'user') {
                style1 = 'flex w-full justify-end';
                style2 = 'bg-gradient-to-br from-indigo-600 to-violet-600 p-4 m-4 rounded-2xl rounded-tr-sm w-2/3 shadow-lg';
            }
            else {
                style1 = 'flex w-full';
                style2 = 'bg-slate-800 p-4 m-4 rounded-2xl rounded-tl-sm w-2/3 shadow-md border border-slate-700';
            }
            if (props.type === 'ERROR') {
                style2 += ' border-2 border-red-500 bg-red-900/20';
            }

            const isAI = props.rol !== 'user';
            return <div className={style1}>
                <div className={style2}>
                    {isAI && props.html ? <div dangerouslySetInnerHTML={{__html: props.html}} /> : props.content}
                </div>
            </div>
        }

        function Messages(props) {
            const ref = React.useRef(null);
            React.useEffect(()=>{
                if (ref.current) {
                    ref.current.scrollTop = ref.current.scrollHeight;
                }
            }, [props.chat]);
            return <div ref={ref} className='flex-1 p-2 overflow-y-auto'>
                {props.chat.map((message, idx) => <Message key={idx} rol={message.rol} content={message.content} type={message.type} html={message.html} />)}
            </div>
        }

        function Chat() {

            let [message, setMessage] = React.useState('');
            let [chat, setChat] = React.useState([]); // arreglo de mensajes
            let [lastRol, setLastRol] = React.useState('')
            let [loading, setLoading] = React.useState(false);

            function handleInput(ev) {
                setMessage(ev.nativeEvent.target.value);
            }

            function escapeHTML(s){
                return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
            }
            function formatLLM(s){
                let safe = escapeHTML(s);
                // bloques de código ```...```
                safe = safe.replace(/```([\s\S]*?)```/g, (m, p1)=>{
                    return `<pre class="bg-slate-800 p-3 rounded overflow-auto"><code>${p1}</code></pre>`;
                });
                // inline `code`
                safe = safe.replace(/`([^`]+)`/g, '<code class="bg-slate-800 px-1 py-0.5 rounded">$1</code>');
                // saltos de línea
                safe = safe.replace(/\n/g,'<br/>');
                return safe;
            }

            async function fetchAIResponse(prompt){
                // Intento 1: vihangayt (sin auth)
                try {
                    const r = await fetch(`https://vihangayt.me/tools/chatgpt?q=${encodeURIComponent(prompt)}`);
                    if (r.ok) {
                        const ct = r.headers.get('content-type') || '';
                        if (ct.includes('application/json')){
                            const j = await r.json();
                            const txt = j.response || j.answer || j.data || j.result || '';
                            if (String(txt).trim()) return String(txt);
                        } else {
                            const t = await r.text();
                            if (String(t).trim()) return t;
                        }
                    }
                } catch {}
                // Intento 2: safone (proxy público)
                try {
                    const r2 = await fetch(`https://api.safone.dev/chatgpt?message=${encodeURIComponent(prompt)}`);
                    if (r2.ok) {
                        const j2 = await r2.json().catch(()=>null);
                        if (j2){
                            const txt2 = j2.response || j2.message || j2.answer || j2.content || '';
                            if (String(txt2).trim()) return String(txt2);
                        } else {
                            const t2 = await r2.text();
                            if (String(t2).trim()) return t2;
                        }
                    }
                } catch {}
                // Intento 3: DuckDuckGo Instant Answer (no IA, pero una respuesta rápida)
                try {
                    const r3 = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(prompt)}&format=json&no_html=1&skip_disambig=1`);
                    if (r3.ok){
                        const j3 = await r3.json();
                        const abstract = j3.AbstractText || j3.Abstract || '';
                        if (String(abstract).trim()) return abstract;
                        const related = (j3.RelatedTopics && j3.RelatedTopics[0] && (j3.RelatedTopics[0].Text || (j3.RelatedTopics[0].Topics && j3.RelatedTopics[0].Topics[0] && j3.RelatedTopics[0].Topics[0].Text))) || '';
                        if (String(related).trim()) return related;
                    }
                } catch {}
                throw new Error('No se pudo obtener respuesta de los servicios públicos.');
            }

            async function handleSend() {
                if (loading) return;
                if (message.split(' ').join('') !== '' && lastRol !== 'user') {
                    const pregunta = message;
                    setChat(prev => [...prev, { rol: 'user', content: pregunta }]);
                    setMessage('');
                    setLastRol('user');
                    setLoading(true);

                    try {
                        const text = await fetchAIResponse(pregunta);
                        setChat(prev => [...prev, { rol: 'gemini', content: text, type: 'MESSAGE', html: formatLLM(text) }]);
                        setLastRol('gemini');
                    } catch (error) {
                        const err = 'ERROR: Connection error, try later.';
                        setChat(prev => [...prev, { rol: 'gemini', content: err, type: 'ERROR', html: formatLLM(err) }]);
                        setLastRol('gemini');
                    } finally {
                        setLoading(false);
                    }
                }
            }

            return <div className='flex-col flex h-full'>
                <Messages chat={chat} />
                <div className='opacity-80 text-sm px-4 flex items-center gap-2 text-indigo-400'>
                    {loading ? (
                        <>
                            <svg className="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Generando respuesta…
                        </>
                    ) : ''}
                </div>
                <UserInput handleInput={handleInput} handleSend={handleSend} message={message} />
            </div>
        }

        function GeminiChat() {
            const chat = { name: 'Gemini chat' };
            

            return <div className='flex flex-col h-full'>
                <Chat />
            </div>;
        }

        // -------------- Docs (README por pestañas + API) --------------
        function mdEscape(s){
            return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
        }
        function mdSlug(s){
            return s.toLowerCase().replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-');
        }
        function mdToHtml(md){
            // Render mínimo: bloques de código, h3, listas, párrafos e inline code
            let out = '';
            const lines = md.split('\n');
            let inCode = false;
            let inList = false;
            for (let i=0;i<lines.length;i++){
                let l = lines[i];
                if (l.startsWith('```')){
                    if (!inCode){ out += '<pre class="bg-slate-800 p-3 rounded overflow-auto"><code>'; inCode=true; }
                    else { out += '</code></pre>'; inCode=false; }
                    continue;
                }
                if (inCode){ out += mdEscape(l) + '\n'; continue; }
                if (l.startsWith('### ')){
                    if (inList){ out += '</ul>'; inList=false; }
                    const h = mdEscape(l.slice(4));
                    const id = mdSlug(h);
                    out += `<h3 id="${id}" class="text-xl font-semibold mt-6 mb-3 scroll-mt-16">${h}</h3>`; continue;
                }
                if (l.trim().startsWith('- ')){
                    if (!inList){ out += '<ul class="list-disc pl-6 space-y-1">'; inList=true; }
                    out += `<li>${mdEscape(l.trim().slice(2))}</li>`; continue;
                }
                if (l.trim()===''){
                    if (inList){ out += '</ul>'; inList=false; }
                    out += '<div class="h-2"></div>'; continue;
                }
                let esc = mdEscape(l).replace(/`([^`]+)`/g, '<code class="bg-slate-800 px-1 py-0.5 rounded">$1</code>');
                out += `<p class="leading-relaxed">${esc}</p>`;
            }
            if (inList){ out += '</ul>'; }
            return out;
        }
        function splitByHeadings(md){
            const sections = [];
            const regex = /^##\s+(.+)$/gm;
            let m; const titles = [];
            while((m = regex.exec(md)) !== null){ titles.push({idx:m.index, title:m[1]}); }
            if (titles.length===0){ return [{title:'README', html: mdToHtml(md)}]; }
            for (let i=0;i<titles.length;i++){
                const start = titles[i].idx;
                const end = (i+1<titles.length)? titles[i+1].idx : md.length;
                const content = md.slice(start, end);
                const title = titles[i].title;
                const cleaned = content.replace(/^##\s+.+\n?/, '');
                sections.push({title, html: mdToHtml(cleaned)});
            }
            return sections;
        }
        function Docs(){
            const [tabs, setTabs] = React.useState([]);
            const [active, setActive] = React.useState('API');
            const [routes, setRoutes] = React.useState([]);
            React.useEffect(()=>{
                // README
                fetch('/file/readme.md').then(r=>r.text()).then(md=>{
                    const secs = splitByHeadings(md);
                    setTabs(secs);
                }).catch(()=>{
                    setTabs([{title:'README', html: '<p>No se pudo cargar el README.</p>'}]);
                })
                // Rutas
                fetch('/api/routes').then(r=>r.json()).then(setRoutes).catch(()=>setRoutes([]));
            },[]);
            function renderTabContent(){
                if (active==='API'){
                    return <div className='p-6'>
                        <div className='text-2xl font-bold mb-4 flex items-center gap-2'>
                            <svg className="w-7 h-7 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                            </svg>
                            API (modules/web.py)
                        </div>
                        <div className='space-y-2'>
                            {routes.map((e,i)=>
                                <div key={i} className='p-4 bg-gradient-to-r from-slate-900 to-slate-800 backdrop-blur rounded-lg border border-slate-700 hover:border-indigo-500/50 transition-all duration-200 flex items-start gap-3 hover:shadow-lg hover:shadow-indigo-500/10'>
                                    <span className={'px-3 py-1 rounded-md text-xs font-bold ' + ((e.methods||[]).includes('POST')? 'bg-pink-600 text-white':'bg-indigo-600 text-white')}>{(e.methods||[]).join('/') || 'GET'}</span>
                                    <code className='text-sm font-mono text-slate-200'>{e.path}</code>
                                    {e.endpoint? <span className='text-sm text-slate-400'>— {e.endpoint}</span>: null}
                                </div>
                            )}
                        </div>
                    </div>
                }
                const tab = tabs.find(t=>t.title===active) || tabs[0];
                return <div className='p-6'>
                    <div className='leading-7 [&_pre]:mt-4 [&_pre]:mb-4 [&_pre]:text-sm [&_code]:font-mono' dangerouslySetInnerHTML={{__html: tab?.html || ''}} />
                </div>
            }
            const allTabTitles = ['API', ...tabs.map(t=>t.title)];
            return <div className='flex flex-col h-full'>
                <div className='sticky top-0 z-10 bg-slate-950/80 backdrop-blur border-b border-slate-800 px-4 pt-3 pb-2'>
                    <div className='flex flex-wrap gap-2'>
                        {allTabTitles.map((t,idx)=>
                            <button key={idx} className={'px-3 py-1.5 text-sm rounded-full border ' + (active===t? 'bg-indigo-600 border-indigo-500 text-white':'bg-slate-800 border-slate-700 text-slate-300 hover:text-white')} onClick={()=>setActive(t)}>{t}</button>
                        )}
                    </div>
                </div>
                <div className='flex-1 overflow-auto'>
                    <div className='max-w-5xl mx-auto my-4 bg-slate-950/40 border border-slate-800 rounded-xl shadow-lg'>
                        {renderTabContent()}
                    </div>
                </div>
            </div>
        }



        function Command(data) {
            return <div className='p-4 bg-slate-900 rounded-md  m-4'>
                <b>{data.name}</b>: <span>{data.desc}</span>
            </div>
        }

        function CommandsTab({ items }){
            const [q, setQ] = React.useState('');
            const list = React.useMemo(()=>{
                const term = q.trim().toLowerCase();
                if (!term) return items;
                return items.filter(c => {
                    const name = String(c[0]||'').toLowerCase();
                    const desc = String(c[1]||'').toLowerCase();
                    return name.includes(term) || desc.includes(term);
                });
            }, [items, q]);
            return <div className='w-full bg-slate-950 pl-4 pr-7 pt-8 overflow-y-auto'>
                <div className='text-4xl pb-4 font-bold bg-gradient-to-r from-indigo-400 to-violet-400 bg-clip-text text-transparent'>Comandos</div>
                <div className='pb-4 text-slate-300'>Busca y revisa la explicación de cada comando.</div>
                <div className='pb-6'>
                    <div className='relative'>
                        <div className='absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none'>
                            <svg className="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <input
                            type='text'
                            value={q}
                            onChange={e=>setQ(e.target.value)}
                            placeholder='Filtrar por nombre o descripción...'
                            className='w-full md:w-1/2 pl-10 bg-slate-800 border-2 border-slate-700 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200'
                        />
                    </div>
                    <div className='text-slate-400 mt-2 text-sm flex items-center gap-2'>
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        {list.length} de {items.length} resultados
                    </div>
                </div>
                <div className='grid gap-3'>
                    {list.map((command, idx) => (
                        <div key={idx} className='p-5 bg-gradient-to-br from-slate-900 to-slate-800 rounded-lg border border-slate-700 hover:border-indigo-500/50 transition-all duration-200 hover:shadow-lg hover:shadow-indigo-500/10'>
                            <div className='text-lg font-semibold flex items-center gap-2'>
                                <svg className="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <code className='bg-slate-800 px-3 py-1.5 rounded-md border border-slate-700'>{command[0]}</code>
                            </div>
                            <div className='text-slate-300 mt-3 ml-7'>{command[1]}</div>
                        </div>
                    ))}
                </div>
            </div>
        }

        function UsersTab({ items }){
            const [q, setQ] = React.useState('');
            const rows = React.useMemo(()=>{
                try {
                    let pairs = [];
                    if (Array.isArray(items)) {
                        pairs = items;
                    } else if (items && typeof items === 'object') {
                        pairs = Object.entries(items);
                    }
                    return pairs.map(([id, raw]) => {
                        let obj = {};
                        try { obj = JSON.parse(String(raw)); } catch {}
                        return {
                            id: obj.id ?? id,
                            username: obj.username ?? '',
                            first_name: obj.first_name ?? '',
                            last_name: obj.last_name ?? '',
                            chat: obj.chat ?? '',
                            lang_code: obj.lang_code ?? '',
                            is_premium: obj.is_premium ?? obj.is_premiun ?? false,
                            dc_id: obj.dc_id ?? '',
                        };
                    });
                } catch { return []; }
            }, [items]);
            const list = React.useMemo(()=>{
                const term = q.trim().toLowerCase();
                if (!term) return rows;
                return rows.filter(u =>
                    String(u.id).includes(term) ||
                    (u.username||'').toLowerCase().includes(term) ||
                    (u.first_name||'').toLowerCase().includes(term) ||
                    (u.last_name||'').toLowerCase().includes(term)
                );
            }, [rows, q]);
            return <div className='w-full bg-slate-950 pl-4 pr-7 pt-8 overflow-y-auto'>
                <div className='text-4xl pb-4 font-bold bg-gradient-to-r from-indigo-400 to-violet-400 bg-clip-text text-transparent'>Usuarios</div>
                <div className='pb-4 text-slate-300'>Personas que le han escrito al bot.</div>
                <div className='pb-6'>
                    <div className='relative'>
                        <div className='absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none'>
                            <svg className="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <input
                            type='text'
                            value={q}
                            onChange={e=>setQ(e.target.value)}
                            placeholder='Buscar por id, username o nombre...'
                            className='w-full md:w-1/2 pl-10 bg-slate-800 border-2 border-slate-700 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200'
                        />
                    </div>
                    <div className='text-slate-400 mt-2 text-sm flex items-center gap-2'>
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        {list.length} usuarios
                    </div>
                </div>
                <div className='overflow-x-auto border-2 border-slate-800 rounded-lg shadow-xl'>
                    <table className='min-w-full text-left text-sm'>
                        <thead className='bg-gradient-to-r from-slate-900 to-slate-800'>
                            <tr>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>ID</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Username</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Nombre</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Apellidos</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>DC</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Premium</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Lang</th>
                                <th className='px-4 py-3 border-b-2 border-slate-700 font-semibold text-indigo-300'>Chat</th>
                            </tr>
                        </thead>
                        <tbody>
                            {list.map(u => (
                                <tr key={u.id} className='hover:bg-slate-800/60 transition-colors duration-150'>
                                    <td className='px-4 py-3 border-b border-slate-800 font-mono text-slate-300'>{u.id}</td>
                                    <td className='px-4 py-3 border-b border-slate-800'>{u.username || '-'}</td>
                                    <td className='px-4 py-3 border-b border-slate-800'>{u.first_name || '-'}</td>
                                    <td className='px-4 py-3 border-b border-slate-800'>{u.last_name || '-'}</td>
                                    <td className='px-4 py-3 border-b border-slate-800'>{u.dc_id || '-'}</td>
                                    <td className='px-4 py-3 border-b border-slate-800'>
                                        {u.is_premium ? 
                                            <span className='inline-flex items-center px-2 py-1 rounded-full text-xs bg-indigo-500/20 text-indigo-300 border border-indigo-500/30'>
                                                <svg className="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                                Sí
                                            </span> : 
                                            <span className='text-slate-500'>No</span>
                                        }
                                    </td>
                                    <td className='px-4 py-3 border-b border-slate-800'>{u.lang_code || '-'}</td>
                                    <td className='px-4 py-3 border-b border-slate-800 font-mono text-xs text-slate-400'>{u.chat || '-'}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        }

        function BotStats(){
            const [stats, setStats] = React.useState([]);
            React.useEffect(()=>{
                let alive = true;
                async function fetchStats(){
                    try{
                        const r = await fetch('/api/stats');
                        const data = await r.json(); // viene como [[k,v], [k,v], ...]
                        if (alive) setStats(data);
                    }catch(e){
                        if (alive) setStats([]);
                    }
                }
                fetchStats();
                const t = setInterval(fetchStats, 1000);
                return ()=>{ alive=false; clearInterval(t); };
            },[]);
            const icons = {
                'Uptime': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
                'CPU': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>,
                'CPU SPEED': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
                'CPU COUNT': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" /></svg>,
                'CPU_TEMP': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
                'MAX_CPU_TEMP': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z" /></svg>,
                'RAM': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>,
                'RAM USED': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>,
                'RAM FREE': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" /></svg>,
                'TOTAL DISK': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" /></svg>,
                'DISK USED': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>,
                'DISK FREE': <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>
            };
            return <div className='w-full bg-slate-950 pl-4 pr-7 pt-6 pb-6 overflow-y-auto'>
                <div className='text-4xl pb-4 font-bold bg-gradient-to-r from-indigo-400 to-violet-400 bg-clip-text text-transparent flex items-center gap-3'>
                    <svg className="w-10 h-10 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Estado del Bot
                </div>
                <div className='grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4'>
                    {stats.map((row, idx)=>{
                        const k = row[0] || '';
                        const v = row[1] || '';
                        const ico = icons[k] || <svg className="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
                        return (
                            <div key={idx} className='p-5 bg-gradient-to-br from-slate-900 to-slate-800 backdrop-blur rounded-lg border border-slate-700 hover:border-indigo-500/50 transition-all duration-200 hover:shadow-lg hover:shadow-indigo-500/10'>
                                <div className='text-sm text-slate-400 flex items-center gap-2'>
                                    <span className='text-indigo-400'>{ico}</span>
                                    <span>{k}</span>
                                </div>
                                <div className='text-2xl font-bold mt-2 text-white'>{v}</div>
                            </div>
                        );
                    })}
                </div>
            </div>
        }

        function Button(data) {
            function handleClick() {
                data.setActive(data.title)
            }
            const isActive = data.active === data.title;
            const base = 'p-3 pl-4 pr-4 rounded-lg m-2 cursor-pointer transition-all duration-200 font-medium';
            const cls = isActive ? 'bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 shadow-lg' : 'bg-slate-800 hover:bg-slate-700 active:bg-slate-800 hover:shadow-md';
            
            // Icon mapping for different sections
            const iconMap = {
                'commands': <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                'users': <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
                'chat': <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>,
                'docs': <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
                'stats': <svg className="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            };
            
            const icon = iconMap[data.title] || null;
            
            return <div className={base + ' ' + cls} onClick={handleClick}>
                {icon}{data.title}
            </div>
        }

        function Panel(data) {
            let buttons = [];

            for (const key in data.comps) {
                if (Object.hasOwnProperty.call(data.comps, key)) {

                    buttons.push(key);

                }
            }

            console.log(data);

            const width = data.panel === 'visible' ? data.width : 0;
            return <div className='h-full overflow-auto bg-slate-950' style={{width: width}}>
                {buttons.map(button => <Button key={button} title={button} active={data.active} setActive={data.setActive} />)}
            </div>
        }

        function Data(props) {

            const usr_temp = {
                USER_ID: 0,
                LAST_MESSAGE_ID: 1,
                LAST_MESSAGE_DOWNLOAD_ID: 13,
                CHAT_ID: 14,
                DC_ID: 15,
                VERIFIED: 16,
                PREMIUM: 17,
                LANG_CODE: 18,
                LAST_NAME: 19,
                FIRST_NAME: 20,
                USERNAME: 21
            };


            switch (props.active) {
                case 'commands':
                    return <CommandsTab items={props.data.commands} />
                case 'users':
                    return <UsersTab items={props.data.users} />
                case 'chat':
                    return <div className='w-full bg-slate-950 pl-4 pr-7 pt-4 overflow-hidden flex flex-col h-full'><GeminiChat /></div>
                case 'docs':
                    return <div className='w-full bg-slate-950 pl-4 pr-7 pt-4 overflow-hidden flex flex-col h-full'><Docs /></div>
                case 'stats':
                    return <BotStats />
                default:
                    return <div className='w-full bg-slate-950 pl-4 pr-7 pt-8 overflow-scroll overflow-scroll'>
                        <div className='text-5xl pb-8'></div>
                        <div>

                        </div>
                    </div>
            }
        }

        function CloseButton(data) {
            return <div className='bg-slate-950 border-r border-slate-800'>
                <div className='w-14 h-14 flex items-center justify-center cursor-pointer hover:bg-slate-800/50 rounded-md transition-all duration-200 active:scale-95' onClick={data.toggle_panel}>
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </div>
            </div>;
        }

    function App(props) {


            let [active, setActive] = React.useState('docs');
            let [panel_state, toggle_panel] = React.useState('visible');
            let [panelWidth, setPanelWidth] = React.useState(384); // px, ~w-96
            let [dragging, setDragging] = React.useState(false);
            const minW = 200, maxW = 640;


            function handle_click() {
                if (panel_state == 'hidden') {
                    toggle_panel('visible');
                } else {
                    toggle_panel('hidden');
                }
            }

            // Resizer handlers
            function handleMouseDown(e){
                setDragging(true);
            }
            React.useEffect(()=>{
                function onMove(e){
                    if (!dragging) return;
                    const newW = Math.min(maxW, Math.max(minW, e.clientX));
                    setPanelWidth(newW);
                }
                function onUp(){ setDragging(false); }
                if (dragging){
                    window.addEventListener('mousemove', onMove);
                    window.addEventListener('mouseup', onUp);
                }
                return ()=>{
                    window.removeEventListener('mousemove', onMove);
                    window.removeEventListener('mouseup', onUp);
                }
            }, [dragging]);


            let data = {
                commands: props.commands,
                users: props.users,
                chat: true,
                docs: true,
                stats: true
            }

            return <div className='h-screen flex'>
                <Panel comps={data} setActive={setActive} panel={panel_state} active={active} width={panelWidth} />
                <div
                    className={'h-full w-1.5 ' + (panel_state==='hidden' ? 'opacity-0 pointer-events-none' : 'opacity-100')}
                    style={{cursor:'col-resize'}}
                    onMouseDown={handleMouseDown}
                >
                    <div className='w-full h-full hover:bg-slate-700/50 transition-colors'></div>
                </div>
                <CloseButton toggle_panel={handle_click} />
                <Data data={data} active={active} />
            </div>
        }




        async function init() {

            let command_api = await fetch('/api/commands');
            let commands = await command_api.json();
            console.log(commands)

            let users_api = await fetch('/api/users');
            let users = await users_api.json();
            console.log(users)

            const root = ReactDOM.createRoot(document.body);

            root.render(<App commands={commands} users={users} />);
        }

        window.onload = init;


    </script>
</body>

</html>